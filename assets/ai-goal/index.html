<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Defend Dad — Basic Goal Tracker</title>
<style>
  /* ---- Old dark theme ---- */
  :root{
    --bg:#0e1117; --panel:#161b22; --line:#30363d;
    --text:#e6edf3; --muted:#9aa4b2; --gold:#d4af37;
    --bar-h: 22px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:960px;margin:0 auto;padding:28px 16px}

  /* Card */
  .tracker{
    background:var(--panel); border:1px solid var(--line);
    border-radius:14px; padding:18px;
  }
  h1{margin:0 0 10px; font-size:1.35rem; color:var(--gold)}
  .meta{
    display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap;
    margin-bottom:12px; font-weight:700;
  }
  .pill{
    display:inline-block; padding:6px 12px; border-radius:999px; font-size:.95rem;
    border:1px solid var(--line); color:var(--muted); background:rgba(13,17,23,.35);
  }
  .pill.raised{ color:#0ed88b; border-color:#0ed88b22 }

  /* Progress bar */
  .bar-wrap{ margin-top:6px }
  .bar{
    position:relative; height:var(--bar-h);
    border:1px solid var(--line); border-radius:12px; overflow:hidden;
    background:#0b0e13;
  }
  .fill{
    position:absolute; inset:0; width:0%;
    background:linear-gradient(90deg,var(--gold),#f6d773);
    transition:width .7s cubic-bezier(.22,.8,.26,1);
  }

  /* Ticks */
  .ticks{ position:relative; height:42px; margin-top:10px; font-size:.85rem; color:var(--muted) }
  .tick{ position:absolute; top:0; transform:translateX(-50%); text-align:center; white-space:nowrap }
  .tick::before{
    content:""; position:absolute; left:50%; top:-10px; transform:translateX(-50%);
    width:1px; height:10px; background:var(--line);
  }
  .amt{ display:block; color:var(--text); font-weight:800 }
  .lbl{ display:block; max-width:140px; margin:0 auto; color:var(--muted) }

  .hint{ margin-top:12px; color:var(--muted); font-size:.95rem }
</style>
</head>
<body>
<div class="wrap">

  <div class="tracker" id="dd-tracker">
    <h1>Goal Progress</h1>

    <div class="meta">
      <div>Raised: <span class="pill raised" id="raised-pill">$0</span></div>
      <div>Goal: <span class="pill" id="goal-pill">$0</span></div>
    </div>

    <div class="bar-wrap" aria-label="Donation progress">
      <div class="bar" role="progressbar" aria-valuemin="0" aria-valuenow="0" aria-valuemax="100" id="progressbar">
        <div class="fill" id="fill"></div>
      </div>
      <div class="ticks" id="ticks" aria-hidden="true"></div>
    </div>

    <p class="hint">Your support moves us to the next milestone. Thank you.</p>
  </div>

</div>

<script>
(async function(){
  const fill = document.getElementById('fill');
  const raisedPill = document.getElementById('raised-pill');
  const goalPill = document.getElementById('goal-pill');
  const ticks = document.getElementById('ticks');
  const progressbar = document.getElementById('progressbar');

  function usd(n){ return '$' + Number(n||0).toLocaleString('en-US', {maximumFractionDigits:0}); }

  try{
    const res = await fetch('/assets/tools/current-donations.json?cb=' + Date.now());
    const data = await res.json();

    const raised = Number(data.raised || 0);
    const goal   = Number(data.goalTotal || 0);
    const miles  = Array.isArray(data.milestones) ? data.milestones : [];

    // Labels
    raisedPill.textContent = usd(raised);
    goalPill.textContent   = usd(goal);

    // Progress %
    const pct = goal > 0 ? Math.max(0, Math.min(100, (raised/goal)*100)) : 0;
    requestAnimationFrame(()=> fill.style.width = pct + '%');
    progressbar.setAttribute('aria-valuenow', Math.round(pct));

    // Build ticks
    ticks.innerHTML = '';
    miles.forEach(ms=>{
      const p = goal > 0 ? Math.min(100, (ms.amount/goal)*100) : 0;
      const el = document.createElement('div');
      el.className = 'tick';
      el.style.left = p + '%';
      el.innerHTML = `<span class="amt">${usd(ms.amount)}</span><span class="lbl">${ms.label||''}</span>`;
      ticks.appendChild(el);
    });
  }catch(e){
    raisedPill.textContent = '—';
    goalPill.textContent = '—';
    console.error('Tracker load error:', e);
  }
})();
</script>
</body>
</html>

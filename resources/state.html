<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Defend Dad – State Resources</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0e1117;
      color: #f1c40f;
      min-height: 100vh;
    }
    header {
      background: #1a1d23;
      padding: 12px 20px;
      text-align: center;
    }
    header a {
      color: #f1c40f;
      margin: 0 12px;
      text-decoration: none;
      font-weight: bold;
    }
    .container {
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background: rgba(14,17,23,0.82);
    }
    h1, h2, h3 {
      color: #f1c40f;
    }
    .card {
      background: #1a1d23;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
    }
    .card a {
      color: #4fa3ff;
      text-decoration: none;
    }
    .infobox {
      background: rgba(255, 255, 255, 0.08);
      border-left: 4px solid #f1c40f;
      padding: 15px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>
    <a href="/">Home</a>
    <a href="/resources.html">Resources</a>
    <a href="/shop.html">Shop</a>
    <a href="/ai.html">Our AI</a>
    <a href="/community.html">Community</a>
    <a href="/donations.html">Donations</a>
  </header>

  <div class="container" id="content">
    <h1>Loading resources…</h1>
  </div>

  <script>
    async function loadResources() {
      const params = new URLSearchParams(window.location.search);
      const stateKey = params.get("state");
      if (!stateKey) {
        document.getElementById("content").innerHTML = "<h1>Error: No state specified.</h1>";
        return;
      }

      try {
        const response = await fetch("/assets/data/resources.json");
        const data = await response.json();

        const stateData = data[stateKey.toLowerCase()];
        if (!stateData) {
          document.getElementById("content").innerHTML = "<h1>No data found for this state.</h1>";
          return;
        }

        // Background images mapping
        const bgMap = {
          wyoming:  "/assets/State/Dad-Wyoming.PNG",
          florida:  "/assets/State/Dad-Florida%20.PNG", // has a space in filename
          texas:    "/assets/State/Dad-Texas.PNG"
        };

        // Apply background if exists
        const bgUrl = bgMap[stateKey.toLowerCase()];
        if (bgUrl) {
          const img = new Image();
          img.onload = () => {
            document.body.style.backgroundImage = `url('${bgUrl}')`;
            document.body.style.backgroundSize = "cover";
            document.body.style.backgroundRepeat = "no-repeat";
            document.body.style.backgroundAttachment = "fixed";
            document.body.style.backgroundPosition = "center";
            document.body.style.backgroundBlendMode = "overlay";
          };
          img.src = bgUrl + `?v=${Date.now()}`;
        }

        // Render content
        let html = `<h1>${stateData.name} Resources</h1>`;

        // Agencies
        if (stateData.agencies && stateData.agencies.length) {
          html += `<div class="card"><h2>Agencies & Legal Aid</h2><ul>`;
          stateData.agencies.forEach(a => {
            html += `<li><a href="${a.url}" target="_blank">${a.label}</a></li>`;
          });
          html += `</ul></div>`;
        }

        // Forms
        if (stateData.forms && stateData.forms.length) {
          html += `<div class="card"><h2>Forms</h2><ul>`;
          stateData.forms.forEach(f => {
            html += `<li><a href="${f.url}" target="_blank">${f.label}</a></li>`;
          });
          html += `</ul></div>`;
        }

        // Statutes
        if (stateData.statutes && stateData.statutes.length) {
          html += `<div class="card"><h2>Statutes</h2><ul>`;
          stateData.statutes.forEach(s => {
            if (typeof s === "string") {
              html += `<li>${s}</li>`;
            } else {
              html += `<li><a href="${s.url}" target="_blank">${s.label}</a></li>`;
            }
          });
          html += `</ul></div>`;
        }

        // Notes
        if (stateData.notes) {
          html += `<div class="card"><h2>Notes</h2><p>${stateData.notes}</p></div>`;
        }

        // Infobox
        if (stateData.infobox) {
          const ib = stateData.infobox;
          html += `<div class="infobox">`;
          html += `<h2>${ib.title}</h2>`;
          if (ib.factors && ib.factors.length) {
            html += `<h3>${ib.factors_title}</h3><ul>`;
            ib.factors.forEach(f => html += `<li>${f}</li>`);
            html += `</ul>`;
          }
          if (ib.stats && ib.stats.length) {
            html += `<h3>${ib.stats_title}</h3><ul>`;
            ib.stats.forEach(s => html += `<li><strong>${s.label}:</strong> ${s.value} – ${s.note}</li>`);
            html += `</ul>`;
          }
          if (ib.disclaimer) {
            html += `<p><em>${ib.disclaimer}</em></p>`;
          }
          html += `</div>`;
        }

        document.getElementById("content").innerHTML = html;
      } catch (err) {
        console.error(err);
        document.getElementById("content").innerHTML = "<h1>Error loading resources</h1>";
      }
    }

    loadResources();
  </script>
</body>
</html>

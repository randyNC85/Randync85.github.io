<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dad’s Library — State</title>

  <!-- Global brand styles (you created this) -->
  <link rel="stylesheet" href="/assets/tools/dd-global.css" />

  <style>
    /* Page-specific polish (kept small; brand tokens come from dd-global.css) */
    .wrap{max-width:980px;margin:0 auto;padding:28px 16px}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:20px;margin:18px 0;box-shadow:0 2px 10px rgba(27,30,45,.04)}
    .heading{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    .mini{
      width:120px; max-width:28vw; height:auto; object-fit:contain;
      border-radius:10px; border:1px solid var(--line); background:#fff;
    }
    h1{margin:0 0 6px;color:var(--purple-ink)}
    .muted{color:var(--muted)}
    .grid{display:grid; gap:14px}
    @media(min-width:760px){ .grid-2{grid-template-columns:1fr 1fr} }
    .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px}
    .card h3{margin:.2rem 0 .4rem;color:var(--purple-ink);font-size:1.05rem}
    .list{margin:.2rem 0 .2rem; padding-left:18px}
    .list li{margin:.28rem 0}
    .pill{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
    .hr{height:1px;background:var(--line);border:0;margin:18px 0}
    .notfound{padding:14px;border:1px dashed var(--line);border-radius:10px;background:#fff}
    /* in-case minis are missing, hide the broken icon */
    img[onerror]{background:#fff}
  </style>
</head>
<body>

  <!-- Global Navigation (brand v2 light) -->
  <nav class="dd-nav" role="navigation" aria-label="Primary">
    <div class="dd-nav__row">
      <a class="dd-brand" href="/">
        <img src="/assets/Image/defend-dad-logo-shield.png" alt="Defend Dad">
        <span>Defend Dad</span>
      </a>
      <button class="dd-hamburger" id="ddToggle" aria-expanded="false" aria-controls="ddDrawer">Menu</button>
    </div>

    <div class="dd-nav__hero">
      <div class="dd-nav__imgwrap">
        <div class="dd-nav__imgmask"></div>
        <div class="dd-nav__links">
          <a href="/">Home</a>
          <a href="/toolbox">Dad’s Toolbox</a>
          <a href="/dads-library/">Dad’s Library</a>
          <a href="/progress">Progress</a>
          <a href="/transparency">Transparency</a>
          <a href="/storefront">Dad’s Storefront</a>
        </div>
      </div>
    </div>

    <div class="dd-drawer" id="ddDrawer">
      <a href="/">Home</a>
      <a href="/toolbox">Dad’s Toolbox</a>
      <a href="/dads-library/">Dad’s Library</a>
      <a href="/progress">Progress</a>
      <a href="/transparency">Transparency</a>
      <a href="/storefront">Dad’s Storefront</a>
    </div>
  </nav>

  <div class="wrap">

    <!-- Header / breadcrumb -->
    <div class="panel">
      <div class="heading">
        <img id="mini" class="mini" src="" alt="" onerror="this.style.display='none'">
        <div>
          <h1 id="stateTitle">Loading…</h1>
          <div class="muted">
            <span class="pill">Dad’s Library</span>
            &nbsp;·&nbsp; <a href="/dads-library/">Back to Regions</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Dynamic content container -->
    <div id="content"></div>

    <!-- Donation tracker (new pages embed) -->
    <div class="panel">
      <h2 style="color:var(--purple-ink);margin:0 0 10px">Help Us Reach the Next Goal</h2>
      <div class="embed" style="border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff">
        <iframe src="/assets/tools/goals.html" title="Defend Dad Donation Tracker" style="width:100%;height:740px;border:0;display:block"></iframe>
      </div>
    </div>

  </div>

  <!-- Mobile nav toggle -->
  <script>
    (function(){
      const btn = document.getElementById('ddToggle');
      const drawer = document.getElementById('ddDrawer');
      if(!btn || !drawer) return;
      btn.addEventListener('click', ()=>{
        const open = drawer.style.display === 'block';
        drawer.style.display = open ? 'none' : 'block';
        btn.setAttribute('aria-expanded', (!open).toString());
      });
    })();
  </script>

  <!-- State loader -->
  <script>
  (async function(){
    const qs = new URLSearchParams(location.search);
    const slug = (qs.get('state')||'').toLowerCase().trim();   // e.g., 'arizona'
    const titleEl = document.getElementById('stateTitle');
    const miniEl  = document.getElementById('mini');
    const content = document.getElementById('content');

    // If no state param, show friendly message.
    if(!slug){
      titleEl.textContent = 'Choose a state';
      content.innerHTML = '<div class="panel notfound">No state selected. Go back to <a href="/dads-library/">regions</a> or browse A–Z.</div>';
      return;
    }

    // Show the mini (uses your minis folder)
    miniEl.src = `/assets/Image/states/mini/${slug}.png`;
    miniEl.alt = slug + ' Defend Dad mini';

    // The grouped JSON files you created
    const bundles = [
      'AL-CA','CO-GA','HI-IA','KS-MD','MA-MO',
      'MT-NJ','NM-OH','OK-SC','SD-VT','VA-WY'
    ];

    // Try each bundle until we find the slug
    let stateData = null, foundBundle = '';
    for(const b of bundles){
      try{
        const res = await fetch(`/assets/States/${b}.json?cb=${Date.now()}`);
        if(!res.ok) continue;
        const obj = await res.json();
        if(obj && Object.prototype.hasOwnProperty.call(obj, slug)){
          stateData = obj[slug];
          foundBundle = b;
          break;
        }
      }catch(e){}
    }

    if(!stateData){
      titleEl.textContent = slug.charAt(0).toUpperCase()+slug.slice(1);
      content.innerHTML = `
        <div class="panel notfound">
          We don’t have this state set up yet. Check back soon, or head to <a href="/dads-library/">regions</a>.
        </div>`;
      return;
    }

    // Title
    titleEl.textContent = stateData.name || (slug.charAt(0).toUpperCase()+slug.slice(1));

    // Helper renderers
    const linkList = (arr)=> arr && arr.length
      ? `<ul class="list">` + arr.map(x=>`<li><a href="${x.url}" target="_blank" rel="noopener">${x.label||x}</a></li>`).join('') + `</ul>`
      : `<p class="muted">—</p>`;

    const bullets = (arr)=> arr && arr.length
      ? `<ul class="list">` + arr.map(x=>`<li>${(x.label? `<strong>${x.label}:</strong> ` : '') + (x.value||x)}</li>`).join('') + `</ul>`
      : `<p class="muted">—</p>`;

    // Build sections
    const agencies     = linkList(stateData.agencies||[]);
    const forms        = linkList(stateData.forms||[]);
    const calculators  = linkList(stateData.calculators||[]);
    const statutes     = (stateData.statutes && stateData.statutes.length)
                          ? `<ul class="list">` + stateData.statutes.map(s => {
                              if(typeof s === 'string') return `<li>${s}</li>`;
                              return `<li><a href="${s.url}" target="_blank" rel="noopener">${s.label}</a></li>`;
                            }).join('') + `</ul>`
                          : `<p class="muted">—</p>`;

    const commonReq    = linkList(stateData.common_requirements||[]);
    const suicide      = linkList(stateData.suicide_help||[]);
    const barLink      = linkList(stateData.state_bar||[]);
    const legalAid     = linkList(stateData.legal_aid||[]);

    // Info box (factors, stats, disclaimer)
    const info = stateData.infobox||{};
    const factors = bullets(info.factors||[]);
    const stats   = bullets(info.stats||[]);
    const notes   = stateData.notes ? `<p class="muted">${stateData.notes}</p>` : '';

    // Compose DOM
    content.innerHTML = `
      <div class="grid grid-2">
        <div class="card">
          <h3>Courts & Agencies</h3>
          ${agencies}
          <h3>Forms & Packets</h3>
          ${forms}
          <h3>Calculators</h3>
          ${calculators}
        </div>

        <div class="card">
          <h3>Statutes / Rules</h3>
          ${statutes}
          <h3>Notes</h3>
          ${notes || '<p class="muted">—</p>'}
        </div>
      </div>

      <div class="panel">
        <h2 style="margin:.2rem 0;color:var(--purple-ink)">${info.title || ('Custody in ' + (stateData.name||''))}</h2>
        <div class="grid grid-2">
          <div class="card">
            <h3>${info.factors_title || 'What Judges Consider'}</h3>
            ${factors}
          </div>
          <div class="card">
            <h3>${info.stats_title || (stateData.name + ' Snapshot')}</h3>
            ${stats}
          </div>
        </div>
        ${info.disclaimer ? `<p class="muted" style="margin-top:8px">${info.disclaimer}</p>` : ''}
      </div>

      <div class="grid grid-2">
        <div class="card">
          <h3>Common Court Requirements</h3>
          ${commonReq}
        </div>
        <div class="card">
          <h3>Suicide & Crisis Help</h3>
          ${suicide}
        </div>
      </div>

      <div class="grid grid-2">
        <div class="card">
          <h3>Find a Lawyer</h3>
          ${barLink}
        </div>
        <div class="card">
          <h3>Legal Aid</h3>
          ${legalAid}
        </div>
      </div>
    `;
  })();
  </script>
</body>
</html>
